<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IELTS Speaking Generator</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    h2 { margin-bottom: 10px; color: #ddd; text-align: center; }

    canvas {
      max-width: 100%;
      height: auto;
      max-height: 80vh;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      margin-bottom: 20px;
      border: 1px solid #333;
    }

    .controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      background: #1e1e1e;
      padding: 15px;
      border-radius: 12px;
      width: 100%;
      max-width: 800px;
      margin-bottom: 20px;
      align-items: center;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: 0.3s;
    }

    .btn-gen { background: #e63946; color: white; }
    .btn-gen:hover { background: #d62839; }

    .btn-dl { background: #457b9d; color: white; }
    .btn-dl:hover { background: #1d3557; }

    .btn-copy { background: #2a9d8f; color: white; }
    .btn-copy:hover { background: #21867a; }

    .toggle-container {
      display: flex;
      align-items: center;
      color: white;
      font-weight: bold;
      gap: 10px;
      background: #333;
      padding: 10px 15px;
      border-radius: 8px;
    }
    
    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #2a9d8f;
    }

    /* Caption Box Styles */
    .caption-box {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      width: 100%;
      max-width: 800px;
      border: 1px solid #333;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .caption-header {
      font-size: 18px;
      color: #aaa;
      margin-bottom: 5px;
      border-bottom: 1px solid #333;
      padding-bottom: 10px;
    }

    textarea {
      width: 100%;
      height: 220px;
      background: #2b2b2b;
      color: #e0e0e0;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
      box-sizing: border-box;
    }

    textarea:focus { outline: 2px solid #457b9d; }
  </style>
</head>
<body>

  <h2>IELTS Cue Card Generator</h2>
  <canvas id="flashcard" width="1080" height="1080"></canvas>

  <div class="controls">
    <div class="toggle-container">
        <input type="checkbox" id="showAnswer" onchange="generateFlashcard()">
        <label for="showAnswer">Show Sample Answer</label>
    </div>
    <button class="btn-gen" onclick="generateFlashcard()">üîÑ Random Topic</button>
    <button class="btn-dl" onclick="downloadFlashcard()">‚¨áÔ∏è Download Image</button>
  </div>

  <div class="caption-box">
    <div class="caption-header">
      üìù Social Media Caption (Full Links Included)
    </div>
    <textarea id="captionText" readonly></textarea>
    <button class="btn-copy" onclick="copyCaption()">üìã Copy Caption</button>
  </div>

  <script>
    const canvas = document.getElementById("flashcard");
    const ctx = canvas.getContext("2d");

    // --- ASSETS ---
    const logoUrl = "https://gen.eptonline.org/logo.png";
    const fbLogo = "https://gen.eptonline.orgfacebook.png";
    const ytLogo = "https://gen.eptonline.orgyoutube.png";
    const instaLogo = "https://gen.eptonline.orginstagram.png"; 
    const webLogoUrl = "https://gen.eptonline.orgwww.png";

    // --- DATA: IELTS Speaking Cue Cards + Sample Answers ---
    const topics = [
      {
        question: "Describe a person who has influenced your life.",
        answer: "My grandfather is my biggest influence. He taught me that patience and kindness are stronger than anger, and he always encouraged me to pursue my education."
      },
      {
        question: "Describe a beautiful place you visited in your country.",
        answer: "I visited Cox's Bazar last winter. The endless sandy beach and the golden sunset over the ocean were mesmerizing and incredibly peaceful."
      },
      {
        question: "Describe an electronic device you find very useful.",
        answer: "My smartphone is essential. It helps me organize my schedule, stay connected with family, and access information instantly whenever I need it."
      },
      {
        question: "Describe a hobby you would like to start.",
        answer: "I would love to start photography. Capturing moments and seeing the world through a lens seems like a creative way to appreciate nature."
      },
      {
        question: "Describe a gift you received that was very special.",
        answer: "I received a handmade watch from my father on my 18th birthday. It is special because he restored it himself, making it a unique family heirloom."
      }
    ];

    // --- DATA: Hashtag Pools ---
    const requiredTags = ["#eptonline", "#IELTS", "#Speaking", "#CueCard"];
    const examTags = ["#IELTSPreparation", "#TOEFL", "#EnglishSpeaking", "#StudyAbroad", "#PublicSpeaking"];
    const engagementTags = ["#EnglishDaily", "#LearnEnglish", "#Discussion", "#IdeaGeneration"];

    let currentItem = null;

    function getRandomColor() {
      const colors = ["#faf339", "#faf339", "#faf339"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    async function loadImage(url) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(img);
        img.onerror = () => {
            console.warn("Failed to load image:", url);
            resolve(null);
        };
        img.src = url;
      });
    }

    // --- HELPER: Wrap Text ---
    function wrapText(context, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let currentY = y;

        for(let n = 0; n < words.length; n++) {
          const testLine = line + words[n] + ' ';
          const metrics = context.measureText(testLine);
          const testWidth = metrics.width;
          if (testWidth > maxWidth && n > 0) {
            context.fillText(line, x, currentY);
            line = words[n] + ' ';
            currentY += lineHeight;
          } else {
            line = testLine;
          }
        }
        context.fillText(line, x, currentY);
        return currentY; 
    }

    // --- CAPTION GENERATOR ---
    function generateCaptionText(item) {
        let text = `üó£Ô∏è IELTS SPEAKING CUE CARD üó£Ô∏è\n\n`;
        text += `Topic: ${item.question}\n\n`;
        
        text += `üí° Idea Generation Challenge:\n`;
        text += `Write at least 2-3 sentences about this topic in English in the comments below! üëá\n\n`;
        
        text += `Practice more at: https://eptonline.org\n`;
        text += `Follow us for daily updates:\n`;
        // Full Links Here
        text += `üåê Website: https://eptonline.org\n`;
        text += `üìò Facebook: https://www.facebook.com/eptonline.org\n`;
        text += `üì∏ Instagram: https://www.instagram.com/eptonline_org\n`;
        text += `üì∫ YouTube: https://www.youtube.com/@eptonlineOrg\n\n`;

        // Hashtags
        let tags = [...requiredTags];
        const shuffledExams = examTags.sort(() => 0.5 - Math.random());
        tags.push(...shuffledExams.slice(0, 3));
        const shuffledEngage = engagementTags.sort(() => 0.5 - Math.random());
        tags.push(...shuffledEngage.slice(0, 2));

        text += tags.join(" ");
        return text;
    }

    function copyCaption() {
        const copyText = document.getElementById("captionText");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value);
        
        const btn = document.querySelector('.btn-copy');
        const originalText = btn.innerText;
        btn.innerText = "‚úÖ Copied!";
        btn.style.background = "#21867a";
        setTimeout(() => {
            btn.innerText = originalText;
            btn.style.background = "#2a9d8f";
        }, 2000);
    }

    async function generateFlashcard() {
      const showAnswer = document.getElementById("showAnswer").checked;

      // Generate new topic only if clicked or first load
      if (!currentItem || (event && event.type === 'click' && event.target.classList.contains('btn-gen'))) {
          currentItem = topics[Math.floor(Math.random() * topics.length)];
          const caption = generateCaptionText(currentItem);
          document.getElementById('captionText').value = caption;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // --- Background ---
      const color1 = getRandomColor();
      const color2 = "#c76e08"; 
      const gradient = ctx.createLinearGradient(0, 0, 0, 1080);
      gradient.addColorStop(0, color1);
      gradient.addColorStop(1, color2);
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // --- Header Logo ---
      const logo = await loadImage(logoUrl);
      if(logo) ctx.drawImage(logo, canvas.width / 2 - 60, 50, 120, 120);

      // --- Title ---
      ctx.fillStyle = "#0a0a0a";
      ctx.font = "bold 40px 'Segoe UI'";
      ctx.textAlign = "center";
      ctx.fillText("IELTS SPEAKING", canvas.width / 2, 220);
      
      ctx.fillStyle = "#615c56";
      ctx.font = "italic 30px 'Segoe UI'";
      ctx.fillText("(Idea Generation)", canvas.width / 2, 270);

      // --- Main Box Container ---
      const boxY = 350;
      const boxHeight = 450;
      const boxWidth = 900;
      const boxX = (canvas.width - boxWidth) / 2;

      ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
      ctx.beginPath();
      ctx.roundRect(boxX, boxY, boxWidth, boxHeight, 30);
      ctx.fill();
      ctx.strokeStyle = "white";
      ctx.lineWidth = 3;
      ctx.stroke();

      // --- CONTENT LOGIC ---
      ctx.textAlign = "center";
      ctx.shadowColor = "rgba(0,0,0,0.5)";
      ctx.shadowBlur = 10;

      if (!showAnswer) {
        // --- VIEW 1: QUESTION ONLY ---
        ctx.fillStyle = "#ffffff";
        ctx.font = "bold 65px 'Arial'"; 
        
        // Center text in box
        wrapText(ctx, currentItem.question, canvas.width / 2, boxY + 140, 850, 85);

        // Call to action
        ctx.shadowBlur = 0; 
        ctx.font = "italic bold 35px 'Segoe UI'";
        ctx.fillStyle = "#e0e0e0";
        ctx.fillText("üëá Write 2-3 sentences in the comments! üëá", canvas.width / 2, boxY + boxHeight + 60);

      } else {
        // --- VIEW 2: QUESTION + SAMPLE ANSWER ---
        
        // 1. Question (Top of box, Smaller)
        ctx.fillStyle = "#faf339"; // Yellow highlight for question
        ctx.font = "bold 45px 'Arial'"; 
        // Move Y up
        let nextY = wrapText(ctx, currentItem.question, canvas.width / 2, boxY + 70, 850, 55);

        // 2. Separator Line
        ctx.beginPath();
        ctx.moveTo(boxX + 100, nextY + 30);
        ctx.lineTo(boxX + boxWidth - 100, nextY + 30);
        ctx.strokeStyle = "rgba(255,255,255,0.3)";
        ctx.lineWidth = 2;
        ctx.stroke();

        // 3. Label
        ctx.shadowBlur = 0;
        ctx.fillStyle = "#ccc";
        ctx.font = "italic 24px 'Segoe UI'";
        ctx.fillText("Sample Idea:", canvas.width / 2, nextY + 70);

        // 4. Sample Answer
        ctx.fillStyle = "#ffffff";
        ctx.font = "normal 38px 'Segoe UI'"; 
        ctx.shadowBlur = 5;
        // Print answer below label
        wrapText(ctx, currentItem.answer, canvas.width / 2, nextY + 120, 850, 50);
      }
      
      ctx.shadowBlur = 0; 

      // --- Footer ---
      ctx.fillStyle = "#0a0a0a";
      ctx.font = "15px Arial";
      ctx.textAlign = "left";
      ctx.fillText("Practice More:", 70, 1020);
      
      const fb = await loadImage(fbLogo);
      const insta = await loadImage(instaLogo);
      const yt = await loadImage(ytLogo);
      const webIcon = await loadImage(webLogoUrl);
      
      // Links
      if (webIcon) {
          ctx.drawImage(webIcon, 50, 1020, 24, 24); 
          ctx.font = "bold 20px Arial";
          ctx.fillStyle = "white"; 
          ctx.textAlign = "left";
          ctx.fillText("eptonline.org", 80, 1040); 
      }
      
      if(fb) {
          ctx.drawImage(fb, 880, 990, 18, 18);
          ctx.font = "bold 16px Arial"; 
          ctx.fillStyle = "white"; 
          ctx.fillText("@eptonline.org", 905, 1005); 
      }

      if(insta) {
          ctx.drawImage(insta, 880, 1014, 18, 18);
          ctx.font = "bold 16px Arial"; 
          ctx.fillStyle = "white"; 
          ctx.fillText("@eptonline_org", 905, 1029);
      }

      if(yt) {
          ctx.drawImage(yt, 880, 1038, 18, 18);
          ctx.font = "bold 16px Arial"; 
          ctx.fillStyle = "white"; 
          ctx.fillText("@eptonlineOrg", 905, 1053);
      }
    }

    // Polyfill for roundRect
    CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
    }

    function downloadFlashcard() {
      const link = document.createElement("a");
      link.download = `IELTS_Speaking_${Date.now()}.png`;
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    // Initialize
    window.onload = function() {
        currentItem = topics[0];
        const caption = generateCaptionText(currentItem);
        document.getElementById('captionText').value = caption;
        generateFlashcard();
    };
  </script>
</body>
</html>
